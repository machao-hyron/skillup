<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hello World</title>
    <link rel="stylesheet" href="./css/my.css">
	<style>
		table{
			border-spacing: 0;
			border:1px solid #a3a3a3;
			width: 300px;
		}
		table tr td{
			border: 1px solid #a3a3a3;
			padding: 5px 10px;
		}
	</style>
    <script type="text/javascript" src="./js/jquery-3.6.1.min.js"></script>
    <script type="text/javascript">
        const getUserUrl = "http://127.0.0.1:3001/getUser";
        const updateUrl = "http://127.0.0.1:3001/update";

        $(document).ready(function(){
            //更新jQ
			updateJQS()
			//清空jQ
			updateQkS()
			//再取得
			Reacquiring()
			//追加jQ
			AppendS()
			//删除JQ
			deleteAS()
        });

        // 更新js
        const xhr = new XMLHttpRequest();
        function updateJQ() {
            let name = document.getElementById("name").value;
            let sexlist = document.getElementsByName("sex");
			let age = document.getElementById("age")!=null?document.getElementById("age").value:'';
            let sex = 0;
            for( i=0; i<sexlist.length; i++ ) {
                if( sexlist[i].checked ) {
                    sex = i;
                    break;
                }
            }
            let data = {name: name, sex: sex,age:age};

            xhr.open("Post", updateUrl);
            xhr.setRequestHeader('content-type', 'application/json');
            xhr.send(JSON.stringify(data));
            xhr.onreadystatechange = function() {
                if( xhr.readyState == 4 ) {
                    let res = JSON.parse(this.responseText);
                    if( res.code == 0 ) {
                        alert("更新成功 !\nuserid: " + res.userid + "\nname: " + res.name + "\nsex: " + res.sex);
                    } else {
                        let res = JSON.parse(this.responseText);
                        alert("更新失败 !\ncode: " + res.code + "\nmsg: " + res.msg);
                    }
                }
            }
        }
		//更新jQ
		function updateJQS(){
			$("#btn2").click(function(){
			    let name = $("#name").val();
			    let sex = $("input:radio[name='sex']:checked").val();
				let age=$("#age").val();
			    let data = {name: name, sex: Number(sex),age:age};
				
			    $.ajax({
			        type: 'POST',
			        url: updateUrl,
			        contentType: 'application/json',
			        data: JSON.stringify(data),
			        success: function(data, status){
			        if( data.code == 0 ) {
			            alert("更新成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex);
			        } else {
			            alert("更新失败 !\ncode: " + data.code + "\nmsg: " + data.msg);
			        }
			    }
			    })
			});
		}
		
		
		//清空js
		function updateQk(){
			document.getElementById("userid").innerHTML="工号：";
			document.getElementById("name").value='';
			document.getElementsByName("sex")[0].checked=false;
			document.getElementsByName("sex")[1].checked=false;
		}
		//清空jQ
		function updateQkS(){
			$("#btn4").click(function(){
				$("#userid").text('工号：');
			    $("#name").val('');
				$('input:radio[name=sex]')[0].checked = false;
				$('input:radio[name=sex]')[1].checked = false;
			});
		}
		
		//再取得
		function Reacquiring(){
			$.get(getUserUrl, function(data, status){
			    if( data.code == 0 ) {
			        alert("获取成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex);
			        $("#userid").text("工号：" + data.userid);
			        $("#name").val(data.name);
			        $("input[name='sex']").get(data.sex).checked = true;
			    } else {
			        alert("获取失败 !\ncode: " + data.code + "\nmsg: " + data.msg);
			    }
			});
		}
		
		//追加js
		function Append(){
			let tr = document.createElement("tr");
			let td = document.createElement("td");
			td.innerHTML = '<p>年龄：<input id="age" type="text" placeholder="请输入年龄"></p></td>';
			tr.appendChild(td);
			document.getElementById('tab').appendChild(tr);
		}
		//追加jQ
		function AppendS(){
			$("#btn7").click(function(){
				$("#tab").append('<tr><td><p>年龄：<input id="age" type="text" placeholder="请输入年龄"></p></td></td></tr>')
			})
		}
		
		//删除js
		function deleteA(){
			var table = document.getElementById("tab"); 
			var child = table.getElementsByTagName("tr");
			for(let i in child){
				if(i>2){
					child[i].remove();
				}
			}
		}
		//删除jQ
		function deleteAS(){
			$("#btn9").click(function(){
				console.log($('#tab tr'))
				let tr=$('#tab tr');
				if(tr.length>3){
					$('#tab tr:last').remove();
				}
			})
		}
		
		
		
    </script>
</head>
<body>
    <h1>用户信息</h1>
    <hr>
    <div>
		<table id="tab" class="tables">
			<tr><td><p id="userid">工号：</p></td></tr>
			<tr><td><p>姓名：<input id="name" type="text" placeholder="请输入姓名"></p></td></tr>
			<tr><td><p>性别：<input id="boy" type="radio" name="sex" value="0">男 <input id="girl" type="radio" name="sex" value="1">女</p></td></tr>
		</table>
		<table class="tables">
			<tr>
				<td>
					<button id="btn1" type="button" onclick="updateJQ()">更新(js)</button><button id="btn2" type="button">更新(jQ)</button>
				</td>
			</tr>
			<tr>
				<td>
					<button id="btn3" type="button" onclick="updateQk()">清空(js)</button><button id="btn4" type="button">清空(jQ)</button>
				</td>
			</tr>
			<tr><td><button id="btn5" type="button" onclick="Reacquiring()">再取得</button></td></tr>
			<tr>
				<td>
					<button id="btn6" type="button" onclick="Append()">追加（js）</button><button id="btn7" type="button">追加（jQ）</button>
				</td>
			</tr>
			<tr>
				<td>
					<button id="btn8" type="button" onclick="deleteA()">删除（js）</button><button id="btn9" type="button">删除（jQ）</button>
				</td>
			</tr>
		</table>
    </div>
</body>
</html>