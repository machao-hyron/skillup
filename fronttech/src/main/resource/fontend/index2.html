<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Hello World</title>
    <link rel="stylesheet" href="../static/css/my.css">

    <script type="text/javascript" src="../static/js/jquery-3.6.1.min.js"></script>
    <script type="text/javascript">
         // const getUserUrl = "http://127.0.0.1:3001/getUser";
         // const updateUrl = "http://127.0.0.1:3001/update";

        $(document).ready(function () {
            //$.get(getUserUrl, function (data, status) {
            $.get('http://localhost:8080', function (data, status) {
                if (data.code == 0) {
                    if (data) {
                        alert("获取成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex + "\nage:" + data.age);
                        $("#userid").text("工号：" + data.userid);
                        $("#name").val(data.name);
                        $("input[name='sex']").get(data.sex).checked = true;
                        $("#age").val(data.age);
                    } else {
                        alert("获取失败 !\ncode: " + data.code + "\nmsg: " + data.msg);
                    }
                }
            });

            // JQuery
            $("#btn2").click(function () {
                let userid=$("#userid").val();
                let name = $("#name").val();
                let sex = $("input:radio[name='sex']:checked").val();
                let age = $("#age").val();
                let data = {'userid':userid,'name': name, sex: Number(sex), 'age': age};
                $.ajax({
                    type: 'POST',
                    //url: updateUrl,
                    url: '/setUser',
                    contentType: 'application/json;charset=UTF-8',
                    data: JSON.stringify(data),
                    dataType:"json",
                    success: function (data) {
                        //if (data.code == 0) {
                        if (data) {
                            alert("更新成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex + "\nage: " + data.age);
                            //     } else {
                            //         alert("更新失败 !\ncode: " + data.code + "\nmsg: " + data.msg);
                            //     }
                            // }
                        }
                    }
                })
            });
            //jquery实现删除操作
            $("#btn4").click(function () {
                if (count == 2) {
                    $("#tr1").remove();
                    count--;
                }
                //jquery实现追加操作
            })
            $("#btn3").click(function () {
                if (count == 1) {
                    $("table").append('<tr id="tr1"><th class="thcolor" style="width: 40em">年龄：</th><td><input id="age" type="text" placeholder="请输入年龄"></td></tr>');
                    count++;
                }
            })
            $(function(){
                $("#btn6").click(function(){
                    $.get(getUser, function(data, status){
                        if( data.code == 0 ) {
                            $("#userid").text("工号：" + data.userid);
                            $("#name").val(data.name);
                            $("input[name='sex']").get(data.sex).checked = true;
                        }
                    });
                });
            })
        });

        // 原始JS
        const xhr = new XMLHttpRequest();

        function updateJQ() {
            let name = document.getElementById("name").value;
            let sexlist = document.getElementsByName("sex");
            let age = document.getElementById("age").value;
            let sex = 0;
            for (i = 0; i < sexlist.length; i++) {
                if (sexlist[i].checked) {
                    sex = i;
                    break;
                }
            }
            let data = {name: name, sex: sex, age: age};

            //xhr.open("Post", updateUrl);
            xhr.open("Post",'http://localhost:8080/setUser')
            xhr.setRequestHeader('content-type', 'application/json');
            xhr.send(JSON.stringify(data));
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    let res = JSON.parse(this.responseText);
                    if (res.code == 0) {
                        alert("更新成功 !\nuserid: " + res.userid + "\nname: " + res.name + "\nsex: " + res.sex + "\nage: " + res.age);
                    } else {
                        let res = JSON.parse(this.responseText);
                        alert("更新失败 !\ncode: " + res.code + "\nmsg: " + res.msg);
                    }
                }
            }
        }

        var count = 1;

        //js实现删除操作
        function clean() {
            if (count == 2) {
                var tr = document.getElementById("tr1");
                tr.remove();
                count--;
            }
        }



    </script>
</head>
<body>
<h1>用户信息</h1>
<hr>
<div id="user" style="border: 1px solid yellow;">
    <!--            <p id="userid">工号：</p>-->
    <!--            <p>姓名：<input id="name" type="text" placeholder="请输入姓名"></p>-->
    <!--            <p>性别：<input id="boy" type="radio" name="sex" value="0">男 <input id="girl" type="radio" name="sex" value="1">女</p>-->

    <table class="table" border="1" cellpadding="3" cellspacing="0">
        <tr>
            <th class="thcolor" style=" width: 40em ">工号：</th>
            <td><input id="userid" type="text" placeholder="JS00001"></td>
        </tr>
        <tr>
            <th class="thcolor" style="width: 40em">姓名：</th>
            <td><input id="name" type="text" placeholder="请输入姓名"></td>
        </tr>
        <tr id="clo">
            <th class="thcolor" style="width: 40em">性别：</th>
            <td id="td"><input id="boy" type="radio" name="sex" value="0">男
                <input id="girl" type="radio" name="sex" value="1">女
            </td>
        </tr>
    </table>
</div>

<div style="contain: content">
    <button id="btn1" type="button" onclick="updateJQ()">更新(js)</button>
    <button id="btn2" type="button">更新(jquery)</button>
    <input id="btn3" type="button" value="追加"/>
    <button id="btn4" type="button">删除(jquery)</button>
    <button id="btn5" type="button" onclick="clean()">删除(js)</button>
    <button id="btn6" type="button">再取得</button>

</div>
</body>
</html>