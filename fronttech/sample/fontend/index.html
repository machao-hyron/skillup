<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>用户信息</title>
    <link rel="stylesheet" href="./css/my.css">

    <script type="text/javascript" src="./js/jquery-3.6.1.min.js"></script>
    <script type="text/javascript">
        const getUserUrl = "http://127.0.0.1:3001/getUser";
        const updateUrl = "http://127.0.0.1:3001/update";

        $(document).ready(function(){
            $.get(getUserUrl, function(data, status){
                if( data.code == 0 ) {
                    alert("获取成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex);
                    $("#userid").text(data.userid);
                    $("#name").val(data.name);
                    $("input[name='sex']").get(data.sex).checked = true;
                } else {
                    alert("获取失败 !\ncode: " + data.code + "\nmsg: " + data.msg);
                }
            });

            // JQuery
            $("#btn2").click(function(){
                let name = $("#name").val();
                let sex = $("input:radio[name='sex']:checked").val();
				let age = $("#age").val();
				let data = {name: name, sex: Number(sex),age: age};
                $.ajax({
                    type: 'POST',
                    url: updateUrl,
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function(data, status){
                    if( data.code == 0 ) {
						if($("#age1")[0]){
							alert("更新成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex + "\nage: " + data.age);
						}else{
							alert("更新成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex);
						}
                    } else {
                        alert("更新失败 !\ncode: " + data.code + "\nmsg: " + data.msg);
                    }
                }
                })
            });
        });

        // 原始JS
        const xhr = new XMLHttpRequest();
        function updateJQ() {
            let name = document.getElementById("name").value;
            let sexlist = document.getElementsByName("sex");
            let sex = 0;
            for( i=0; i<sexlist.length; i++ ) {
                if( sexlist[i].checked ) {
                    sex = i;
                    break;
                }
            }
			var age;
			if(document.getElementById('age')){
				age = document.getElementById("age").value;
			}
			let data = {name: name, sex: sex, age: age};
            xhr.open("Post", updateUrl);
            xhr.setRequestHeader('content-type', 'application/json');
            xhr.send(JSON.stringify(data));
            xhr.onreadystatechange = function() {
                if( xhr.readyState == 4 ) {
                    let res = JSON.parse(this.responseText);
                    if( res.code == 0 ) {
						if(document.getElementById('age1')){
							alert("更新成功 !\nuserid: " + res.userid + "\nname: " + res.name + "\nsex: " + res.sex + "\nage: " + res.age);
						}else{
							alert("更新成功 !\nuserid: " + res.userid + "\nname: " + res.name + "\nsex: " + res.sex);
						}
                    } else {
                        let res = JSON.parse(this.responseText);
                        alert("更新失败 !\ncode: " + res.code + "\nmsg: " + res.msg);
                    }
                }
            }
        }
		
		// 清空JS
        function delJS() {
           document.getElementById('name').value='';
		   let sexAll = document.getElementsByName("sex");
		   for(i=0;i<sexAll.length;i++){
				sexAll[i].checked ="";
		   }
		   if(document.getElementById('age')){
				document.getElementById('age').value='';
		   }
        }
		
		// 删除JS
        function removeJS() {
			if(document.getElementById('age1')){
				document.getElementById('age1').remove();
			}else{
				alert("年龄行未追加");
			}
        }
		
		$(function (){
			// 清空JQ
			$("#del2").click(function(){
				$("#name").val('');
				$("#boy").prop("checked",false);
				$("#girl").prop("checked",false);
				
				if($("#age")[0]){
					$("#age").val('');
				}
			})
			
			// 再取得JQ
			$("#test2").click(function(){
                $.get(getUserUrl, function(data, status){
                if( data.code == 0 ) {
					if($("#age1")[0]){
						$("#age").val(data.age);
						alert("获取成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex + "\nage: " + data.age);
					}else{
						alert("获取成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex);
					}
                    $("#userid").text("工号：" + data.userid);
                    $("#name").val(data.name);
                    $("input[name='sex']").get(data.sex).checked = true;
                } else {
                    alert("获取失败 !\ncode: " + data.code + "\nmsg: " + data.msg);
                }
				})
			})
			
			// 追加
			$("#test3").click(function(){
				if($("#age1")[0]){
					alert("请勿重复点击");
				}else{
					$("#sex2").parent().parent().append("<tr id=age1><th>年龄：</th><td><input id=age type=text placeholder=请输入年龄 class=text></td></tr>");
				}
			})
			
			// 删除JQ
			$("#remove2").click(function(){
			    if($("#age1")[0]){
					$("#age1").remove();
				}else{
					alert("年龄行未追加");
				}
			})
		})
	
    </script>
</head>
<body>
    <h1>用户信息</h1>
    <hr>
    <div>
		<table class="user">
			<tr>
				<th>工号：</th>
				<td id='userid'></td>
			</tr>
			<tr>
				<th>姓名：</th>
				<td><input id="name" type="text" placeholder="请输入姓名" class="text"></td>
			</tr>
			<tr>
				<th id="test4">性别：</th>
				<td id="sex2"><input id="boy" type="radio" name="sex" value="0">男 <input id="girl" type="radio" name="sex" value="1">女</td>
			</tr>
		</table>
		<button id="btn1" type="button" onclick="updateJQ()">更新(js)</button>
		<button id="btn2" type="button">更新(jq)</button>
		<button id="del1" type="button" onclick="delJS()">清空(js)</button>
		<button id="del2" type="button">清空(jq)</button>
		<button id="test2" type="button">再取得(jq)</button>
		<button id="test3" type="button">追加</button>
		<button id="remove1" type="button" onclick="removeJS()">删除(js)</button>
		<button id="remove2" type="button">删除(jq)</button>
    </div>
</body>
</html>