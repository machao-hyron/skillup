<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hello World</title>
    <link rel="stylesheet" href="./css/my.css">

    <script type="text/javascript" src="./js/jquery-3.6.1.min.js"></script>
    <script type="text/javascript" src="./js/back.js"></script>
    <script type="text/javascript">
        const getUserUrl = "http://127.0.0.1:3001/getUser";
        const updateUrl = "http://127.0.0.1:3001/update";

        $(document).ready(function(){
            $.get(getUserUrl, function(data, status){
                if( data.code == 0 ) {
                    alert("获取成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex);
                    $("#userid").text(data.userid);
                    $("#name").val(data.name);
                    $("input[name='sex']").get(data.sex).checked = true;
                } else {
                    alert("获取失败 !\ncode: " + data.code + "\nmsg: " + data.msg);
                }
            });

            // 更新JQuery
            $("#btn2").click(function(){
                let name = $("#name").val();
                let sex = $("input:radio[name='sex']:checked").val();
                let age = $('#age').val();
                console.log(age);
                let data = {name: name, sex: Number(sex), age: age};
                                console.log(data);
                $.ajax({
                    type: 'POST',
                    url: updateUrl,
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function(data, status){
                    if( data.code == 0 ) {
                        alert("更新成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex);
                    } else {
                        alert("更新失败 !\ncode: " + data.code + "\nmsg: " + data.msg);
                    }
                }
                })
            });
            //清空(jq)
            $("#btn4").click(function(){
                $("#name").val(null);
                $("#age").val(null);
                $("#boy").prop("checked",false);
                $("#girl").prop("checked",false);
            });
            //再取得
            $("#btn5").click(function(){
                $.get(getUserUrl, function(data, status){
                    if( data.code == 0 ) {
                      alert("获取成功 !\nuserid: " + data.userid + "\nname: " + data.name + "\nsex: " + data.sex+ "\nage: " + data.age);
                       $("#userid").text("工号：" + data.userid);
                       $("#name").val(data.name);
                       $("#age").val(data.age);
                      $("input[name='sex']").get(data.sex).checked = true;
                  } else {
                      alert("获取失败 !\ncode: " + data.code + "\nmsg: " + data.msg);
                  }
                });
            });
            //追加(jq)
            $("#btn7").click(function(){
                //$("#table").append('<p id="add">年龄：<input type="text" name="age" id="age"></p>');
                $("#table1").append('<tr id="addtr"><th id="add">年龄：</th><th><input type="text" name="age" id="age"></th>/tr>');
            });
            //删除(jq)
            $("#btn9").click(function(){
                $("#addtr").remove();
            });

        });

        // 原始JS
        const xhr = new XMLHttpRequest();
        function updateJQ() {
            let name = document.getElementById("name").value;
            let sexlist = document.getElementsByName("sex");
            let sex = 0;
            for( i=0; i<sexlist.length; i++ ) {
                if( sexlist[i].checked ) {
                    sex = i;
                    break;
                }
            }
            let data = {name: name, sex: sex};
            if(document.getElementById("age")!=null){
                let age = document.getElementById("age").value;
                data = {name: name, sex: sex, age: age};
            }

            xhr.open("Post", updateUrl);
            xhr.setRequestHeader('content-type', 'application/json');
            xhr.send(JSON.stringify(data));
            xhr.onreadystatechange = function() {
                if( xhr.readyState == 4 ) {
                    let res = JSON.parse(this.responseText);
                    if( res.code == 0 ) {
                        alert("更新成功 !\nuserid: " + res.userid + "\nname: " + res.name + "\nsex: " + res.sex);
                    } else {
                        let res = JSON.parse(this.responseText);
                        alert("更新失败 !\ncode: " + res.code + "\nmsg: " + res.msg);
                    }
                }
            }
        }
        //清空(js)
        function resetJS() {
            document.getElementById("name").value= "";
            if(document.getElementById("age")!=null){
                document.getElementById("age").value= "";
            }
            let sexlist = document.getElementsByName("sex");
            let sex = 0;
            for( i=0; i<sexlist.length; i++ ) {
                sexlist[i].checked = false;
            }
        }
        //追加(js)
        function addJS() {
            let father = document.getElementById("table1");
            let addtr = document.createElement("tr");
            let addth1 = document.createElement("th");
            let addth2 = document.createElement("th");
            addth1.innerHTML="年龄：";
            addtr.setAttribute('id', "addtr");
            let text =document.createElement('input');
            text.setAttribute('type', 'text');//输入框的类型
            text.setAttribute('id', "age");//输入框的id
            addth2.appendChild(text);
            addtr.appendChild(addth1);
            addtr.appendChild(addth2);
            father.appendChild(addtr);
         }
        //删除(js)
         function deleteJS() {
            var deleteChild  = document.getElementById("addtr");
            deleteChild.remove();
         }

    </script>
</head>
<body>
    <h1>用户信息</h1>
    <hr>
    <div id = "table">
        <table id = "table1" border="1">
             <tr>
                 <th>工号：</th><th id="userid"></th>
             </tr>
             <tr>
                 <th>姓名：</th>
                 <th><input id="name" type="text" placeholder="请输入姓名"></th>
             </tr>
             <tr>
                 <th id="sexx">性别：</th>
                 <th><input id="boy" type="radio" name="sex" value="0">男 <input id="girl" type="radio" name="sex" value="1">女</th>
             </tr>
        </table>
    </div>
    <div id = "button">
        <table id = "table2" border="1">
            <tr>
                <th>
                    <button id="btn1" type="button" onclick="updateJQ()">更新(js)</button>
                </th>
                <th>
                    <button id="btn2" type="button">更新(jq)</button>
                </th>
            </tr>
            <tr>
                <th>
                   <button id="btn3" type="button" onclick="resetJS()">清空(js)</button>
                </th>
                <th>
                   <button id="btn4" type="button">清空(jq)</button>
                </th>
            </tr>
            <tr>
                <th colspan="2">
                    <button id="btn5" type="button">再取得</button>
                </th>
            </tr>
            <tr>
                <th>
                    <button id="btn6" type="button" onclick="addJS()">追加(js)</button>
                </th>
                <th>
                    <button id="btn7" type="button">追加(jq)</button>
                </th>
            </tr>
            <tr>
                <th>
                    <button id="btn8" type="button" onclick="deleteJS()">删除(js)</button>
                </th>
                <th>
                    <button id="btn9" type="button">删除(jq)</button>
                </th>
            </tr>
        </table>
    </div>
</body>
</html>